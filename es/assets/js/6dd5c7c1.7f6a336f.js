"use strict";(globalThis.webpackChunkdocusaurus=globalThis.webpackChunkdocusaurus||[]).push([[3310],{5044:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"chat-sse","title":"Chat & Streaming Guide","description":"The Agrinet conversation engine provides real-time messaging, bot responders, and streaming status updates via Server-Sent Events (SSE). Use this guide to integrate chat UX, automate support flows, and monitor conversation state changes.","source":"@site/versioned_docs/version-1.1.0/chat-sse.md","sourceDirName":".","slug":"/chat-sse","permalink":"/es/docs/chat-sse","draft":false,"unlisted":false,"editUrl":"https://github.com/NTARI-RAND/agrinet-docs/versioned_docs/version-1.1.0/chat-sse.md","tags":[],"version":"1.1.0","sidebarPosition":3,"frontMatter":{"title":"Chat & Streaming Guide","sidebar_position":3},"sidebar":"tutorial","previous":{"title":"Marketplace API Guide","permalink":"/es/docs/marketplace-api"},"next":{"title":"SMS Access & Queueing","permalink":"/es/docs/sms-setup"}}');var i=s(4848),r=s(8453);const o={title:"Chat & Streaming Guide",sidebar_position:3},a=void 0,c={},d=[{value:"Conversations",id:"conversations",level:2},{value:"Create Conversation",id:"create-conversation",level:3},{value:"List Conversations",id:"list-conversations",level:3},{value:"Messages",id:"messages",level:2},{value:"Send Message",id:"send-message",level:3},{value:"Fetch Messages",id:"fetch-messages",level:3},{value:"Streaming (SSE)",id:"streaming-sse",level:2},{value:"Subscribe to Conversation Stream",id:"subscribe-to-conversation-stream",level:3},{value:"Global Event Feed",id:"global-event-feed",level:3},{value:"Bot Responders",id:"bot-responders",level:2},{value:"Authentication &amp; Security",id:"authentication--security",level:2},{value:"Monitoring &amp; Troubleshooting",id:"monitoring--troubleshooting",level:2}];function l(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"The Agrinet conversation engine provides real-time messaging, bot responders, and streaming status updates via Server-Sent Events (SSE). Use this guide to integrate chat UX, automate support flows, and monitor conversation state changes."}),"\n",(0,i.jsx)(n.h2,{id:"conversations",children:"Conversations"}),"\n",(0,i.jsx)(n.h3,{id:"create-conversation",children:"Create Conversation"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"POST /conversations"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "title": "Contract 45AB Support",\n  "participants": ["user_prod7", "user_buyer1"],\n  "metadata": {\n    "contractId": "contract_45ab",\n    "channel": "web"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Response:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "id": "conv_91c2",\n  "title": "Contract 45AB Support",\n  "createdAt": "2025-03-02T11:20:01.002Z"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"list-conversations",children:"List Conversations"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"GET /conversations?participant=user_prod7"})}),"\n",(0,i.jsx)(n.p,{children:"Returns conversation summaries including unread counts, last message preview, and linked contract IDs."}),"\n",(0,i.jsx)(n.h2,{id:"messages",children:"Messages"}),"\n",(0,i.jsx)(n.h3,{id:"send-message",children:"Send Message"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"POST /messages/:conversationId"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "from": "user_prod7",\n  "to": "user_buyer1",\n  "type": "text",\n  "content": "Shipment is on schedule.",\n  "attachments": [\n    {\n      "url": "https://cdn.example.org/uploads/photo.jpg",\n      "contentType": "image/jpeg"\n    }\n  ]\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Supported message ",(0,i.jsx)(n.code,{children:"type"})," values: ",(0,i.jsx)(n.code,{children:"text"}),", ",(0,i.jsx)(n.code,{children:"image"}),", ",(0,i.jsx)(n.code,{children:"file"}),", ",(0,i.jsx)(n.code,{children:"ping"}),". Files are stored under ",(0,i.jsx)(n.code,{children:"/uploads"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"fetch-messages",children:"Fetch Messages"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"GET /messages/:conversationId?limit=50&before=<messageId>"})}),"\n",(0,i.jsxs)(n.p,{children:["Returns a paginated array of message objects with read receipts and metadata such as ",(0,i.jsx)(n.code,{children:"isAutomated"})," when generated by responders."]}),"\n",(0,i.jsx)(n.h2,{id:"streaming-sse",children:"Streaming (SSE)"}),"\n",(0,i.jsx)(n.h3,{id:"subscribe-to-conversation-stream",children:"Subscribe to Conversation Stream"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"GET /stream/:conversationId"})}),"\n",(0,i.jsx)(n.p,{children:"Headers:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Accept: text/event-stream\nx-api-key: <service-key>\n"})}),"\n",(0,i.jsx)(n.p,{children:"Sample event payload:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'event: message\nid: msg_ae12\ndata: {"conversationId":"conv_91c2","messageId":"msg_ae12","type":"text","from":"agrinet-responder","content":"Here is the delivery checklist."}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"global-event-feed",children:"Global Event Feed"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"GET /events"})}),"\n",(0,i.jsxs)(n.p,{children:["Use this feed to capture contract pings, notifications, and background job status changes. Events emit ",(0,i.jsx)(n.code,{children:"type"})," fields such as ",(0,i.jsx)(n.code,{children:"ping.update"}),", ",(0,i.jsx)(n.code,{children:"federation.sync"}),", and ",(0,i.jsx)(n.code,{children:"notification.read"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"bot-responders",children:"Bot Responders"}),"\n",(0,i.jsx)(n.p,{children:"Two responder services are available:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Agrinet responder (",(0,i.jsx)(n.code,{children:"backend/services/agrinetResponder.js"}),")"]})," \u2014 Provides rule-based knowledge and contextual prompts."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["OpenAI responder (",(0,i.jsx)(n.code,{children:"backend/services/openAIResponder.js"}),")"]})," \u2014 Optional integration with external LLMs for advanced replies."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Enable or disable responders per conversation by sending:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"POST /conversations/:conversationId/bots"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "bot": "agrinet",\n  "enabled": true\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"authentication--security",children:"Authentication & Security"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["JWTs secure user-driven chat; API keys (",(0,i.jsx)(n.code,{children:"x-api-key"}),") secure SSE and bot control calls."]}),"\n",(0,i.jsxs)(n.li,{children:["OAuth2 providers can exchange access tokens through ",(0,i.jsx)(n.code,{children:"/api/auth/oauth/callback"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["McEliese key issuance endpoints (",(0,i.jsx)(n.code,{children:"/api/keys"}),") set streaming limits and expiration."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"monitoring--troubleshooting",children:"Monitoring & Troubleshooting"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Track message delivery via ",(0,i.jsx)(n.code,{children:"/messages/:conversationId/delivery"})," logs."]}),"\n",(0,i.jsxs)(n.li,{children:["Inspect SSE heartbeats (",(0,i.jsx)(n.code,{children:"event: ping"}),") to detect dropped connections."]}),"\n",(0,i.jsx)(n.li,{children:"Use background workers to retry failed bot invocations and queue SMS fallbacks for offline participants."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Combine chat with the notifications and SMS guides to implement omnichannel support for producers and buyers."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(6540);const i={},r=t.createContext(i);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);