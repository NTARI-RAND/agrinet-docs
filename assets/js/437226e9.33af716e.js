"use strict";(globalThis.webpackChunkdocusaurus=globalThis.webpackChunkdocusaurus||[]).push([[2789],{3063:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"federation-guide","title":"Federation Deployment & Operations","description":"The Agrinet federation network links regional marketplaces, co-ops, and partner nodes into a shared commerce layer. This guide merges the original deployment launch kit with the new operations runbook so operators have one place to review prerequisites, onboarding flows, synchronization jobs, and compliance guardrails.","source":"@site/versioned_docs/version-1.1.0/federation-guide.md","sourceDirName":".","slug":"/federation-guide","permalink":"/docs/federation-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/NTARI-RAND/agrinet-docs/versioned_docs/version-1.1.0/federation-guide.md","tags":[],"version":"1.1.0","sidebarPosition":7,"frontMatter":{"title":"Federation Deployment & Operations","sidebar_position":7},"sidebar":"tutorial","previous":{"title":"Payments & Financial Tools","permalink":"/docs/payments"},"next":{"title":"Federation Node Guide","permalink":"/docs/federation-node-guide"}}');var s=r(4848),o=r(8453);const t={title:"Federation Deployment & Operations",sidebar_position:7},a=void 0,d={},l=[{value:"System Requirements",id:"system-requirements",level:2},{value:"Environment &amp; Credentials",id:"environment--credentials",level:2},{value:"Deployment Bootstrap Script",id:"deployment-bootstrap-script",level:2},{value:"Core Capabilities &amp; Architecture",id:"core-capabilities--architecture",level:2},{value:"Registration &amp; Discovery Workflow",id:"registration--discovery-workflow",level:2},{value:"Synchronization &amp; Background Jobs",id:"synchronization--background-jobs",level:2},{value:"Security Handshake &amp; Compliance Checklist",id:"security-handshake--compliance-checklist",level:2},{value:"Trends &amp; Analytics Sharing",id:"trends--analytics-sharing",level:2},{value:"Troubleshooting Playbook",id:"troubleshooting-playbook",level:2},{value:"Federation Status CLI",id:"federation-status-cli",level:2},{value:"Appendix: Node Template",id:"appendix-node-template",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"The Agrinet federation network links regional marketplaces, co-ops, and partner nodes into a shared commerce layer. This guide merges the original deployment launch kit with the new operations runbook so operators have one place to review prerequisites, onboarding flows, synchronization jobs, and compliance guardrails."}),"\n",(0,s.jsx)(n.h2,{id:"system-requirements",children:"System Requirements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Ubuntu 20.04+ (x86_64 or ARM) host or compatible Linux distribution."}),"\n",(0,s.jsx)(n.li,{children:"Node.js v18+ for API servers and worker processes."}),"\n",(0,s.jsx)(n.li,{children:"AWS DynamoDB (cloud-hosted or Local) for listings, contracts, conversations, and federation metadata."}),"\n",(0,s.jsx)(n.li,{children:"Git for pulling updates and managing configuration."}),"\n",(0,s.jsx)(n.li,{children:"PM2 or systemd to supervise long-running services."}),"\n",(0,s.jsx)(n.li,{children:"Optional: Nginx reverse proxy for TLS termination, Redis for BullMQ queues, and Docker if you prefer containerized workers."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"environment--credentials",children:"Environment & Credentials"}),"\n",(0,s.jsx)(n.p,{children:"Configure the core environment variables before starting any service or worker:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-env",children:'JWT_SECRET="<random-string>"\nAPI_KEY="<federation-api-key>"\nAWS_REGION="<region>"\nAWS_ACCESS_KEY_ID="<key>"\nAWS_SECRET_ACCESS_KEY="<secret>"\nDYNAMODB_ENDPOINT="http://dynamodb-local:8000" # optional for local dev\nFEDERATION_WEBHOOK_SECRET="<shared-secret>"\nSTRIPE_KEY="<sk_live_or_test>"            # optional for payouts\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Twilio credentials (",(0,s.jsx)(n.code,{children:"TWILIO_ACCOUNT_SID"}),", ",(0,s.jsx)(n.code,{children:"TWILIO_AUTH_TOKEN"}),") enable SMS queue workers, while OAuth2 client IDs unlock admin dashboards. Rotate keys regularly and follow the repository ",(0,s.jsx)(n.code,{children:"SECURITY.md"})," guidelines when reporting vulnerabilities."]}),"\n",(0,s.jsx)(n.h2,{id:"deployment-bootstrap-script",children:"Deployment Bootstrap Script"}),"\n",(0,s.jsx)(n.p,{children:"Use the following script to provision a production-ready node:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="install.sh"',children:"#!/bin/bash\nsudo apt update && sudo apt install -y nodejs npm git dynamodb\n\ngit clone https://github.com/NTARI-RAND/Agrinet.git\ncd Agrinet/backend\n\ncp .env.example .env\nnpm install\n\n# Setup PM2\nnpm install -g pm2\npm run build\npm start\npm save\n"})}),"\n",(0,s.jsx)(n.p,{children:"Schedule recurring federation syncs with cron or your scheduler of choice:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'*/30 * * * * curl -s "$BACKEND_URL/federation/sync"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Set ",(0,s.jsx)(n.code,{children:"BACKEND_URL"})," to the publicly reachable backend URL. The cron job keeps your node aligned with peers."]}),"\n",(0,s.jsx)(n.h2,{id:"core-capabilities--architecture",children:"Core Capabilities & Architecture"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Node registry & sync"}),": Register nodes, pull peer exports, and exchange data via the Open Dialog and Mycelium modules."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Compliance enforcement"}),": Apply federation rules, LBTAS trust scoring, and audit logging to every synchronized transaction."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Analytics sharing"}),": Publish ",(0,s.jsx)(n.code,{children:"/trends"})," insights powered by ",(0,s.jsx)(n.code,{children:"aiTrendHelper"})," for regional monitoring."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Background workers"}),": Run ",(0,s.jsx)(n.code,{children:"federation-sync"}),", key-expiry cleaners, SMS dispatchers, and notification broadcasters."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"registration--discovery-workflow",children:"Registration & Discovery Workflow"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Action"}),(0,s.jsx)(n.th,{children:"Endpoint"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Register a node"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST /federation/node/register"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'{ "nodeUrl": "https://node.example.org", "region": "West Africa", "contactEmail": "ops@node.org" }'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"View nodes"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GET /federation/nodes"})}),(0,s.jsx)(n.td,{children:"Returns node metadata, sync status, region, and trust score."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Export catalog"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GET /federation/export"})}),(0,s.jsx)(n.td,{children:"Streams listings, contracts, and trend snapshots from the local node."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pull peer export"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST /federation/pull"})}),(0,s.jsxs)(n.td,{children:["Body: ",(0,s.jsx)(n.code,{children:'{ "sourceUrl": "https://peer.example.net" }'})," to trigger a sync job."]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Every registration is signed with the requesting node's API key. Store TLS fingerprints per peer and require OAuth2 tokens for operator dashboards."}),"\n",(0,s.jsx)(n.h2,{id:"synchronization--background-jobs",children:"Synchronization & Background Jobs"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Launch the federation worker (",(0,s.jsx)(n.code,{children:"node workers/federationSyncJob.js"}),") or the Docker Compose service ",(0,s.jsx)(n.code,{children:"federation-sync"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["The worker polls ",(0,s.jsx)(n.code,{children:"/federation/nodes"}),", enqueues BullMQ jobs, and fetches ",(0,s.jsx)(n.code,{children:"/federation/export"})," payloads from peers."]}),"\n",(0,s.jsx)(n.li,{children:"Jobs validate hashes, merge listings/contracts, and record progress in the notifications table."}),"\n",(0,s.jsxs)(n.li,{children:["SSE channels (",(0,s.jsx)(n.code,{children:"/events"}),", ",(0,s.jsx)(n.code,{children:"/stream/:conversationId"}),") broadcast sync updates to dashboards and chat threads."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Open Dialog negotiates conflict resolution with timestamped CRDT payloads; Mycelium handles fine-grained deltas."}),"\n",(0,s.jsx)(n.h2,{id:"security-handshake--compliance-checklist",children:"Security Handshake & Compliance Checklist"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use verified TLS for every node exchange and retain the last received hash per peer."}),"\n",(0,s.jsx)(n.li,{children:"Synchronize only with registered nodes and track reliability through the LBTAS trust layer."}),"\n",(0,s.jsxs)(n.li,{children:["Log dialog transcripts via ",(0,s.jsx)(n.code,{children:"transactionLog.js"})," to support audits."]}),"\n",(0,s.jsxs)(n.li,{children:["Post LBTAS ratings for each contract settlement through ",(0,s.jsx)(n.code,{children:"POST /submitRating"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Apply geofencing with helpers in ",(0,s.jsx)(n.code,{children:"backend/utils/geo.js"})," before importing listings."]}),"\n",(0,s.jsx)(n.li,{children:"Run the key-expiry cleaner to purge stale tokens and prevent unauthorized pushes."}),"\n",(0,s.jsx)(n.li,{children:"Honor repository licensing (GPL v3.0) and follow governance rules documented for federation operators."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"trends--analytics-sharing",children:"Trends & Analytics Sharing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer <token>" https://api.example.org/trends?region=global\n'})}),"\n",(0,s.jsx)(n.p,{children:"Example response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "summary": "Maize prices up 12% week-over-week in Lake Zone.",\n  "topSignals": [\n    { "commodity": "maize", "changePct": 12, "confidence": 0.83 }\n  ],\n  "generatedBy": "aiTrendHelper"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Publish anonymized transaction counts and pricing data on a set cadence or via DynamoDB streams to keep partners informed."}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting-playbook",children:"Troubleshooting Playbook"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sync drift:"})," Re-run ",(0,s.jsx)(n.code,{children:"POST /federation/pull"})," with a ",(0,s.jsx)(n.code,{children:"force"})," flag to rebuild the catalog."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Job backlog:"})," Inspect BullMQ queues (for example, ",(0,s.jsx)(n.code,{children:"federationQueue"}),") and scale worker replicas."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Auth failures:"})," Rotate JWT secrets and confirm API keys through ",(0,s.jsx)(n.code,{children:"/api/keys"})," admin routes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data mismatch:"})," Check schema versions advertised in registry metadata before accepting payloads."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"federation-status-cli",children:"Federation Status CLI"}),"\n",(0,s.jsx)(n.p,{children:"Monitor peer health with the bundled CLI:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd frontend\nnode federationStatusCLI.js              # defaults to http://localhost:5000\nBACKEND_URL=https://api.example.com node federationStatusCLI.js\n"})}),"\n",(0,s.jsx)(n.p,{children:"Example output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\ud83c\udf0d Federation Node Status Report\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Node URL                    \u2502 Status     \u2502 Listings  \u2502 Transactions \u2502 Users   \u2502 Last Sync     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 http://node1.example.org    \u2502 \u2705 ONLINE  \u2502 123       \u2502 456          \u2502 10      \u2502 5/20/2025 ... \u2502\n\u2502 http://node2.example.org    \u2502 \u274c OFFLINE \u2502 -         \u2502 -            \u2502 -       \u2502 N/A           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.p,{children:"Install dependencies if needed:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install chalk cli-table3 axios\n"})}),"\n",(0,s.jsx)(n.h2,{id:"appendix-node-template",children:"Appendix: Node Template"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "nodeId": "node-1",\n  "production": { "capabilities": [] },\n  "services": {\n    "educational": [],\n    "socialMedia": [],\n    "extension": [],\n    "financial": {\n      "marketListings": [],\n      "grants": []\n    },\n    "marketing": {\n      "onNetwork": [],\n      "socialMediaSyndication": []\n    },\n    "messaging": {\n      "enabled": false,\n      "levesonRatings": []\n    }\n  },\n  "reputation": { "leveson": 0 },\n  "interoperability": []\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["For day-to-day runbooks and troubleshooting, pair this guide with the focused ",(0,s.jsx)(n.a,{href:"/docs/federation-node-guide",children:"Federation Node Guide"})," that breaks down worker scheduling, analytics sharing, and compliance workflows in even greater depth."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>a});var i=r(6540);const s={},o=i.createContext(s);function t(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);