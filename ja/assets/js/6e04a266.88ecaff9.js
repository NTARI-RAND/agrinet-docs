"use strict";(globalThis.webpackChunkdocusaurus=globalThis.webpackChunkdocusaurus||[]).push([[2985],{8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>d});var i=r(6540);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},8487:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"federation-node-guide","title":"Federation Node Guide","description":"The Agrinet federation layer links regional nodes, co-ops, and partner platforms into a shared marketplace with synchronized listings, analytics, and compliance monitoring. Pair this runbook with the consolidated Federation Deployment & Operations reference for provisioning checklists and governance requirements.","source":"@site/docs/federation-node-guide.md","sourceDirName":".","slug":"/federation-node-guide","permalink":"/ja/docs/next/federation-node-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/NTARI-RAND/agrinet-docs/docs/federation-node-guide.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Federation Node Guide","sidebar_position":6},"sidebar":"tutorial","previous":{"title":"Federation Deployment & Operations","permalink":"/ja/docs/next/federation-guide"},"next":{"title":"Federation Node Onboarding","permalink":"/ja/docs/next/onboarding"}}');var s=r(4848),t=r(8453);const o={title:"Federation Node Guide",sidebar_position:6},d=void 0,a={},l=[{value:"Core Capabilities",id:"core-capabilities",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Registration &amp; Discovery",id:"registration--discovery",level:2},{value:"Synchronization Workflow",id:"synchronization-workflow",level:2},{value:"Compliance Checklist",id:"compliance-checklist",level:2},{value:"Trends &amp; Analytics Sharing",id:"trends--analytics-sharing",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["The Agrinet federation layer links regional nodes, co-ops, and partner platforms into a shared marketplace with synchronized listings, analytics, and compliance monitoring. Pair this runbook with the consolidated ",(0,s.jsx)(n.a,{href:"/ja/docs/next/federation-guide",children:"Federation Deployment & Operations"})," reference for provisioning checklists and governance requirements."]}),"\n",(0,s.jsx)(n.h2,{id:"core-capabilities",children:"Core Capabilities"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Node registry & sync:"})," Register nodes, pull peer exports, and exchange data using the Open Dialog and Mycelium sync modules."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Compliance enforcement:"})," Apply federation rules, LBTAS trust scoring, and audit logging to every synchronized transaction."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Analytics sharing:"})," Publish market intelligence via ",(0,s.jsx)(n.code,{children:"/trends"})," endpoints powered by the ",(0,s.jsx)(n.code,{children:"aiTrendHelper"})," summarization pipeline."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Background workers:"})," Schedule ",(0,s.jsx)(n.code,{children:"federation-sync"})," jobs alongside key expiry cleaners and notification emitters to keep nodes consistent."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Requirement"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Node.js \u2265 20"}),(0,s.jsx)(n.td,{children:"Matches backend runtime and supports worker threads."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DynamoDB (AWS or Local)"}),(0,s.jsx)(n.td,{children:"Stores listings, contracts, conversations, and federation metadata."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Redis or compatible BullMQ store"}),(0,s.jsx)(n.td,{children:"Powers job queues for federation sync, SMS, and key expiry tasks."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"TLS certificates"}),(0,s.jsx)(n.td,{children:"Required for node registration trust validation."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Optional Stripe credentials"}),(0,s.jsx)(n.td,{children:"Enable fiat payouts during cross-node settlement."})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Set the following environment variables before starting workers:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-env",children:'JWT_SECRET="<random-string>"\nAPI_KEY="<federation-api-key>"\nAWS_REGION="<region>"\nAWS_ACCESS_KEY_ID="<key>"\nAWS_SECRET_ACCESS_KEY="<secret>"\nDYNAMODB_ENDPOINT="http://dynamodb-local:8000" # optional for local dev\nFEDERATION_WEBHOOK_SECRET="<shared-secret>"\nSTRIPE_KEY="<sk_live_or_test>"            # optional for payouts\n'})}),"\n",(0,s.jsx)(n.h2,{id:"registration--discovery",children:"Registration & Discovery"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Action"}),(0,s.jsx)(n.th,{children:"Endpoint"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Register a node"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST /federation/node/register"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'{"nodeUrl":"https://node.example.org","region":"West Africa","contactEmail":"ops@node.org"}'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"View nodes"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GET /federation/nodes"})}),(0,s.jsx)(n.td,{children:"Returns array of node metadata with sync status, region, and trust score."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Export catalog"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GET /federation/export"})}),(0,s.jsx)(n.td,{children:"Streams listings, contracts, and trend snapshots from the local node."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pull peer export"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST /federation/pull"})}),(0,s.jsxs)(n.td,{children:["Body: ",(0,s.jsx)(n.code,{children:'{ "sourceUrl": "https://peer.example.net" }'})," to trigger a sync job."]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Every registration is signed with the requesting node's API key. Store the node's TLS fingerprint and require OAuth2 tokens for operator dashboards."}),"\n",(0,s.jsx)(n.h2,{id:"synchronization-workflow",children:"Synchronization Workflow"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Schedule the background worker: ",(0,s.jsx)(n.code,{children:"node workers/federationSyncJob.js"})," or run via Docker Compose service ",(0,s.jsx)(n.code,{children:"federation-sync"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Worker polls ",(0,s.jsx)(n.code,{children:"/federation/nodes"})," and queues BullMQ jobs for each eligible peer."]}),"\n",(0,s.jsxs)(n.li,{children:["Each job fetches ",(0,s.jsx)(n.code,{children:"/federation/export"})," from the peer, validates hashes, and merges listings/contracts into the local datastore."]}),"\n",(0,s.jsxs)(n.li,{children:["Progress is recorded in the notification table, enabling ",(0,s.jsx)(n.code,{children:"/events"})," and ",(0,s.jsx)(n.code,{children:"/stream/:conversationId"})," SSE channels to broadcast sync updates."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The Mycelium module handles fine-grained delta updates, while the Open Dialog module negotiates conflict resolution using timestamped CRDT payloads."}),"\n",(0,s.jsx)(n.h2,{id:"compliance-checklist",children:"Compliance Checklist"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Ensure every contract settlement posts an LBTAS rating via ",(0,s.jsx)(n.code,{children:"POST /submitRating"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Retain dialog transcripts in ",(0,s.jsx)(n.code,{children:"transactionLog.js"})," for audits."]}),"\n",(0,s.jsxs)(n.li,{children:["Apply geo-fencing filters on imported listings with helpers in ",(0,s.jsx)(n.code,{children:"backend/utils/geo.js"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Purge expired keys with the key-expiry cleaner worker to prevent unauthorized federation pushes."}),"\n",(0,s.jsxs)(n.li,{children:["Follow governance policies defined in ",(0,s.jsx)(n.code,{children:"docs/federation-guide.md"})," and the repository ",(0,s.jsx)(n.code,{children:"SECURITY.md"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"trends--analytics-sharing",children:"Trends & Analytics Sharing"}),"\n",(0,s.jsx)(n.p,{children:"Expose aggregated insights for federation partners through the trends API:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer <token>" https://api.example.org/trends?region=global\n'})}),"\n",(0,s.jsx)(n.p,{children:"Response snippet:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "summary": "Maize prices up 12% week-over-week in Lake Zone.",\n  "topSignals": [\n    { "commodity": "maize", "changePct": 12, "confidence": 0.83 }\n  ],\n  "generatedBy": "aiTrendHelper"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Use DynamoDB streams or scheduled exports to publish anonymized transaction counts and pricing data."}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sync drift:"})," Re-run ",(0,s.jsx)(n.code,{children:"POST /federation/pull"})," with the ",(0,s.jsx)(n.code,{children:"force"})," flag to rebuild the catalog from peers."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Job backlog:"})," Inspect BullMQ queues (e.g., ",(0,s.jsx)(n.code,{children:"federationQueue"}),") and scale worker replicas."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Auth failures:"})," Rotate JWT secrets and confirm API keys are loaded via ",(0,s.jsx)(n.code,{children:"/api/keys"})," admin routes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data mismatch:"})," Verify each node shares the same schema version indicated in the registry metadata."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"For a complete operator runbook, combine this guide with the deployment quickstart and payments reference to ensure cross-node settlements reconcile correctly."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);