"use strict";(globalThis.webpackChunkdocusaurus=globalThis.webpackChunkdocusaurus||[]).push([[2484],{1978:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"sms-setup","title":"SMS Access & Queueing","description":"Provide SMS access for users without smartphones by wiring Twilio webhooks, offline queues, and localized replies. The SMS gateway mirrors marketplace and weather capabilities exposed in the Agrinet Engine.","source":"@site/docs/sms-setup.md","sourceDirName":".","slug":"/sms-setup","permalink":"/tr/docs/next/sms-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/NTARI-RAND/agrinet-docs/docs/sms-setup.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"SMS Access & Queueing","sidebar_position":4},"sidebar":"tutorial","previous":{"title":"Chat & Streaming Guide","permalink":"/tr/docs/next/chat-sse"},"next":{"title":"Payments & Financial Tools","permalink":"/tr/docs/next/payments"}}');var r=i(4848),t=i(8453);const o={title:"SMS Access & Queueing",sidebar_position:4},l=void 0,a={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Inbound Webhooks",id:"inbound-webhooks",level:2},{value:"Outbound Queueing",id:"outbound-queueing",level:2},{value:"Local Language Support",id:"local-language-support",level:2},{value:"Offline &amp; Retry Strategy",id:"offline--retry-strategy",level:2},{value:"Integrations",id:"integrations",level:2}];function d(e){const n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Provide SMS access for users without smartphones by wiring Twilio webhooks, offline queues, and localized replies. The SMS gateway mirrors marketplace and weather capabilities exposed in the Agrinet Engine."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Twilio programmable SMS number with webhook support."}),"\n",(0,r.jsx)(n.li,{children:"Exposed HTTPS endpoint reachable by Twilio (use ngrok for local testing)."}),"\n",(0,r.jsx)(n.li,{children:"Configured environment variables:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"TWILIO_ACCOUNT_SID=ACxxxxxxxx\nTWILIO_AUTH_TOKEN=xxxxxxxx\nTWILIO_SMS_NUMBER=+15551234567\nSMS_LOCALE_DEFAULT=en\nSMS_OFFLINE_QUEUE=true\n"})}),"\n",(0,r.jsx)(n.h2,{id:"inbound-webhooks",children:"Inbound Webhooks"}),"\n",(0,r.jsx)(n.p,{children:"Twilio invokes the SMS routes with payloads containing sender, body, and metadata."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"POST /sms/inbound"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "From": "+255700123456",\n  "To": "+15551234567",\n  "Body": "price maize",\n  "MessageSid": "SM1234567890"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Handler actions:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Parse the intent (e.g., market price lookup, weather query, contract status)."}),"\n",(0,r.jsxs)(n.li,{children:["Enqueue processing work in ",(0,r.jsx)(n.code,{children:"bull/smsQueue.js"})," for asynchronous responses."]}),"\n",(0,r.jsx)(n.li,{children:"Log interactions for audit and LBTAS context."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Return a TwiML response confirming receipt or immediate reply content."}),"\n",(0,r.jsx)(n.h2,{id:"outbound-queueing",children:"Outbound Queueing"}),"\n",(0,r.jsx)(n.p,{children:"Send SMS updates or alerts through the queue worker."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"POST /sms/queue"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "to": "+255700123456",\n  "body": "Maize (Grade A) is 480 KES/kg in Kisumu market.",\n  "locale": "sw"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Workers translate content when localized templates exist and store delivery attempts in DynamoDB. Delivery confirmations from Twilio hit ",(0,r.jsx)(n.code,{children:"POST /sms/status"})," with ",(0,r.jsx)(n.code,{children:"MessageStatus"})," payloads."]}),"\n",(0,r.jsx)(n.h2,{id:"local-language-support",children:"Local Language Support"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Provide translation files per locale (e.g., ",(0,r.jsx)(n.code,{children:"sms/translations/sw.json"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Use fallback to ",(0,r.jsx)(n.code,{children:"SMS_LOCALE_DEFAULT"})," when no translation is available."]}),"\n",(0,r.jsx)(n.li,{children:"Include transliteration for languages requiring Latin script approximations."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"offline--retry-strategy",children:"Offline & Retry Strategy"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Enable ",(0,r.jsx)(n.code,{children:"SMS_OFFLINE_QUEUE"})," to cache outbound messages when connectivity is lost."]}),"\n",(0,r.jsxs)(n.li,{children:["Workers retry with exponential backoff, tagging messages with ",(0,r.jsx)(n.code,{children:"deliveryAttempts"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Confirm final delivery before marking associated notifications as complete."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"integrations",children:"Integrations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Trigger SMS alerts for contract pings (",(0,r.jsx)(n.code,{children:"/contracts/:id/pings"}),") and rating reminders."]}),"\n",(0,r.jsx)(n.li,{children:"Provide weather data by querying connected services via background jobs."}),"\n",(0,r.jsxs)(n.li,{children:["Mirror chat messages by piping critical notifications from ",(0,r.jsx)(n.code,{children:"/events"})," SSE into SMS for offline participants."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Monitor Twilio logs and BullMQ dashboards to maintain throughput and troubleshoot delivery failures."})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var s=i(6540);const r={},t=s.createContext(r);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);